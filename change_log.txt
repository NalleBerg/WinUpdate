=== WinProgramSuite Change Log ===
Notes for future versioned changelog

=====================================
Date: 2026-02-05 (Update 11 - Installed Apps Refresh & i18n Fix)
Component: WinProgramManager

INSTALLED APPS: Automatic Cleanup & Manual Refresh
---------------------------------------------------------
- NEW FEATURE: "Refresh Installed Apps" button appears when Installed filter is active
- Automatic cleanup: CleanupInstalledApps() verifies registry entries for all apps
- Comprehensive discovery: DiscoverInstalledApps() uses winget list for external installations
- Button styling: Blue (RGB 10,57,129) matching existing UI, conditionally positioned
- Two-phase startup: Winget phase → Database phase with proper progress text
- Manual refresh: Users can detect apps installed outside the manager

INTERNATIONALIZATION: Critical Fixes
---------------------------------------------------------
- FIXED: Locale loading now uses .txt extension (was incorrectly looking for .ini)
- FIXED: Windows line endings (CRLF \r\n) now used for multi-line text display
- Multi-line support: Startup dialog, button text, and tooltips now display correctly
- Locale files verified: en_GB.txt, nb_NO.txt, sv_SE.txt all loading properly
- Norwegian release ready: All UI text uses i18n system with proper formatting

MANUAL UPDATE DIALOG: Visual Enhancements
---------------------------------------------------------
- Text styling: 16pt Segoe UI Bold for better visibility
- Multi-line display: Both message lines now visible ("Checking installed apps..." / "This can take some time...")
- Spinner sizing: Matched to startup spinner (60pt font) for consistency
- Dialog dimensions: 250×85 pixels with proper spacing (text at y=15, spinner at y=43)
- Layout optimization: Spinner positioned to avoid bottom cutoff

TOOLTIP SYSTEM: WinUpdate-Style Implementation
---------------------------------------------------------
- Multi-line tooltip: DT_WORDBREAK support with Windows CRLF line breaks
- Custom tooltip class: WPMSimpleTooltip with COLOR_INFOBK background
- Positioning: Appears above cursor, auto-hides on mouse leave
- Content: "Discover apps installed outside this manager.\nThis may take a while."

TECHNICAL IMPLEMENTATION:
- CleanupInstalledApps(): Registry verification using HKLM/HKCU uninstall keys
- DiscoverInstalledApps(): Full winget list execution with parsed output
- LoadLocale(): Converts \\n to \r\n for proper Windows text control display
- Button visibility: ShowWindow(SW_SHOW/SW_HIDE) based on g_installedFilterActive
- Dialog resource: IDD_LOADING_DIALOG with proper control dimensions and styles

=====================================
Date: 2026-02-03 (Update 10 - App Details Dialog UX Enhancement)
Component: WinProgramManager

APP DETAILS DIALOG: Visual & Usability Improvements
---------------------------------------------------------
- Optimized icon display: Scaled from 21x19 to 50x50 pixels using GDI StretchBlt with HALFTONE mode
- Enhanced readability: Font increased from 9pt to 11pt Segoe UI (~22% larger for high-res displays)
- Improved layout: Standardized 15px spacing between fields (Package ID, Source, Status)
- Compact dialog: Reduced dimensions to 500x295 pixels with better space utilization
- Tags field enhancement: Height increased to 24px with ES_MULTILINE for horizontal scrollbar support
- Homepage usability: Changed to read-only EDITTEXT control for text selection and copy functionality
- Icon quality: HALFTONE scaling mode provides optimal clarity for 50x50 display size
- UX: Users can now select and copy homepage URLs via right-click context menu

TECHNICAL IMPLEMENTATION:
- GDI icon scaling: CreateCompatibleDC, StretchBlt with HALFTONE, CreateIconIndirect
- Resource file: Updated IDD_APP_DETAILS with new dimensions and control properties
- Control styles: ES_READONLY | ES_AUTOHSCROLL for homepage field
- Font metrics: 11pt provides better visibility on 4K/high-DPI displays
- Layout coordinates: Icon(12,12) 50x50, Package ID y=64, Source y=79, Status y=94

=====================================
Date: 2026-02-03 (Update 9 - Extended Metadata & App Details Enhancement)
Component: WinProgramManager / WinProgramUpdater / Database

DATABASE: 29-Column Schema Extension
---------------------------------------------------------
- Expanded database from 21 to 29 columns (added 8 metadata fields)
- New fields: source, installer_type, architecture, documentation_url, installer_url, 
  installer_sha256, offline_distribution_supported, commands
- All 10,692 apps now include complete installer and distribution metadata
- Maintains backward compatibility - SQL queries work with both schemas

WINPROGRAMUPDATER: Enhanced Package Parsing
---------------------------------------------------------
- Updated GetPackageInfo() to parse installer section from winget show output
- Extracts Installer Type (msi, exe, msix, appx, nullsoft, inno, burn, zip, etc.)
- Captures Architecture (x64, x86, arm64, arm, neutral)
- Records Documentation URL, Installer URL, SHA256 hash, Offline Distribution Support
- Default values: source="winget", architecture="x64" for missing data
- INSERT statement expanded to handle all 27 columns (29 minus auto id/processed_at)

APP DETAILS DIALOG: Installer Metadata Display
---------------------------------------------------------
- Added installer_type and architecture fields to app details dialog
- SQL query updated to retrieve metadata: columns 9-11 (source, installer_type, architecture)
- Display format: "Installer Type: nullsoft" and "Architecture: x64"
- Verified with Notepad++ 8.9 (nullsoft, x64) and other packages

LOADING DIALOG: Text Visibility Fix
---------------------------------------------------------
- Fixed invisible "Processing database, please wait..." text on startup spinner
- Changed WM_CTLCOLORSTATIC from TRANSPARENT to OPAQUE background mode
- Increased font size to 18pt bold Segoe UI for better visibility
- Made font handle static to persist throughout program lifetime
- Added explicit UpdateWindow() call to force immediate rendering
- Added processing_database and wait_moment strings to all locale files (en_GB, nb_NO, sv_SE)
- Full i18n support: English, Norwegian ("Behandler database..."), Swedish ("Bearbetar databas...")

BUILD SYSTEM: Database Preservation
---------------------------------------------------------
- Simplified makeit.bat backup logic - only backs up to ..\DB\timestamp.db
- Fixed backup path from incorrect nested directory to correct WinProgramManager\WinProgramManager\
- Databases preserved across rebuilds (no longer moved/restored)
- Backup rotation maintains last 10 timestamped copies

TESTING & VERIFICATION:
- All 10,692 apps verified with populated installer_type and architecture
- Database integrity verified: "ok" from PRAGMA integrity_check
- Fast 10-15 second startup maintained with all icon loading
- App details dialog confirmed showing all new fields correctly
- Loading text now visible in all supported languages during database initialization

=====================================
Date: 2026-02-02 (Update 8 - WinProgramUpdaterGUI Enhancements)
Component: WinProgramManager / WinProgramUpdaterGUI

LOG VIEWER: RTF Rendering & Visual Formatting
---------------------------------------------------------
- Fixed log viewer button - corrected window procedure routing from dialog to window proc
- Implemented RTF rendering using EM_STREAMIN with callback for RichEdit50W control
- Bold timestamps: [YYYY-MM-DD HH:MM:SS] displayed in bold black
- Blue "Time update took" lines: Colored in blue (RGB 0,0,255) for visibility
- Error highlighting: Red text for error messages
- Success highlighting: Green text for success messages
- Proper RTF streaming with EDITSTREAM callback for reliable content delivery

KEYBOARD SHORTCUTS: Universal Support
---------------------------------------------------------
- Created reusable keyboard_shortcuts.h/.cpp module
- Ctrl+W: Close window - Works in both main window and log viewer
- Ctrl+A: Select all text - Works in both main window (Edit control) and log viewer (RichEdit)
- Ctrl+C: Copy selected text - Manual clipboard implementation for reliable copy operations
- Accelerator table integration in message loop with TranslateAccelerator
- Commands work via keyboard, context menu, and programmatic calls

CONTEXT MENUS: Right-Click Support
---------------------------------------------------------
- Added WM_CONTEXTMENU handlers for both main window and log viewer
- Popup menus show "Copy    Ctrl+C" and "Select All    Ctrl+A" with keyboard hints
- Context menu commands route to same handlers as keyboard shortcuts
- Keyboard invocation support (Shift+F10 or Apps key) with GetCursorPos fallback
- Manual clipboard API implementation using GlobalAlloc/GlobalLock/SetClipboardData
- EM_GETSEL/EM_EXGETSEL for selection ranges in Edit and RichEdit controls
- CF_UNICODETEXT clipboard format for full Unicode support

BUILD SYSTEM: windowsx.h Integration
---------------------------------------------------------
- Added #include <windowsx.h> for GET_X_LPARAM and GET_Y_LPARAM macros
- Successfully compiled all 4 executables with new features
- All changes packaged to WinProgramManager/WinProgramManager/ directory

=====================================
Date: 2026-02-02 (Update 7 - Database Protection & Updater Improvements)
Component: WinProgramManager / Build Scripts

CRITICAL: Database Protection - Update-Only Mode
---------------------------------------------------------
- Modified build_everything.ps1 and build_complete_db.ps1 to NEVER delete existing database
- Removed Initialize-MainDatabase() function that deleted and recreated database structure
- Build scripts now require existing WinProgramManager.db file - will NOT create from scratch
- Error message directs users to https://prog.nalle.no to download pre-built database (115MB)
- Prevents accidental data loss: Database with 10,800+ apps is now protected from purging
- Scripts operate in UPDATE-ONLY mode: Only adds new packages, updates metadata, removes obsolete entries
- Database restoration verified: 10,707 apps including Notepad++.Notepad++, Microsoft.VCRedist packages

DATABASE UPDATER: Obsolete Package Count Reporting
---------------------------------------------------------
- Updated check_deleted_packages.ps1 to clearly report deletion count
- Messages: "Removed X obsolete package(s) from database" or "No obsolete packages found - database is clean"
- Improves transparency: Users now see exact count of packages removed during Step 3
- Consistent reporting across all update steps (Step 2 already showed addition count)

PACKAGE SUPPORT: Special Characters in Package IDs
---------------------------------------------------------
- Verified WinProgramUpdater handles packages with + character correctly
- No filters exclude special characters from package ID parsing
- Right-to-left tokenization accepts all characters in package IDs
- Successfully added Microsoft.VCRedist.2015+.x86 and Microsoft.VCRedist.2015+.x64 to database
- Note: These packages were missing from original database build, now properly supported

COMPILATION: WinProgramManager Executables
---------------------------------------------------------
- Successfully compiled all WinProgramManager components using makeit.bat
- WinProgramManager.exe: Main GUI application (600KB)
- WinProgramUpdaterGUI.exe: New unified updater with GUI and silent modes
- WinProgramUpdater.exe: Legacy GUI updater (marked for eventual removal)
- All executables packaged in WinProgramManager/ distribution directory

=====================================
Date: 2026-02-01 (Update 6 - Winget List Parser Fix for Variable Column Count)
Component: WinProgramManager / WinProgramUpdater

CRITICAL PARSER FIX: Variable Column Count Support
---------------------------------------------------------
- Fixed SyncInstalledApps() to handle variable column count in "winget list" output
- Bug: Parser used fixed positional logic (tokens[size-3] = ID), failed when "Available" column present
- Impact: ~5 packages missing including Notepad++.Notepad++, possibly Total Commander, Blender
- Root Cause: When updates available, winget list shows 5 columns instead of 4:
  * Without updates: Name | Id | Version | Source (4 columns)
  * With updates: Name | Id | Version | Available | Source (5 columns)
  * Fixed position parsing captured "Available" value instead of package ID
- Fix: Implemented regex-based right-to-left package ID detection:
  * Pattern: ^[A-Za-z0-9+_-]*[A-Za-z][A-Za-z0-9+._-]*\.[A-Za-z0-9+_-]*[A-Za-z][A-Za-z0-9+._-]*$
  * Requires letters on both sides of dot to distinguish from version numbers (e.g., 8.9.1)
  * Supports + character for packages like Notepad++.Notepad++
  * Scans tokens right-to-left starting after Source column
  * Falls back to positional logic if no regex match found
- Additional Fixes:
  * Spinner animation filtering: Winget uses \r for progress spinner, now filters lines with only -, \, |, / chars
  * Carriage return handling: Changed ExecuteWingetCommand from getline() to istreambuf_iterator
  * Character support: Added + to allowed package ID characters (was only ._-)
- Result: All packages correctly detected, verified Notepad++, Total Commander, Blender in database (49 packages total)
- Debug logging: Added comprehensive trace to sync_debug.txt in LOCALAPPDATA for troubleshooting

=====================================
Date: 2026-02-01 (Update 5 - Critical Bug Fixes & Performance Optimization)
Component: WinProgramManager / WinProgramUpdater

CRITICAL BUGFIX: Database Deletion Prevention
---------------------------------------------------------
- Fixed CRITICAL database wipe bug in WinProgramUpdater.cpp
- Bug: DeleteFileW(L"WinProgramsSearch.db") used relative path instead of absolute path
- Impact: Could delete main database (10,780+ apps) if working directory was incorrect
- Fix: Changed to DeleteFileW(searchDbPath_.c_str()) using absolute path calculated in constructor
- Prevention: All file operations now use searchDbPath_ member variable with full path
- Recovery: Database backup system proved invaluable, restored 116MB database from .\DB\ backup
- Result: Database file operations are now safe regardless of working directory

MAJOR BUGFIX: Winget Batch Mode Parsing
---------------------------------------------------------
- Fixed GetPackageInfo() parsing failure in WinProgramUpdater.cpp
- Bug: Parser stopped at first spinner line (764-935 chars), never found "Found" line in batch mode
- Impact: All 35 packages cross-referenced from installed_apps failed with "Could not retrieve package info"
- Root Cause: Batch mode output differs from interactive mode:
  * Interactive: Has "Found <Name> [PackageId]" line
  * Batch: No "Found" line, starts directly with "Version:" field
  * Both: Can have 764-935 character spinner progress lines
- Fix: Implemented foundName flag that continues searching for "Found" line through entire output
- Fallback: If no "Found" line found, extract name from packageId (e.g., "7zip.7zip" → "7zip")
- Result: Parser now handles both interactive and batch modes, all 35 packages added successfully

PERFORMANCE: Step 2.5 Eliminated (4+ hours → <1 second)
---------------------------------------------------------
- Replaced PowerShell loop calling winget show 259 times with single SQL query
- Old: External add_missing_installed_packages.ps1 script took 4+ hours
- New: SQL cross-reference query using ATTACH DATABASE completed instantly:
  ```sql
  SELECT DISTINCT sr.package_id 
  FROM search_db.search_results sr 
  INNER JOIN installed_apps ia ON sr.package_id = ia.package_id 
  WHERE sr.package_id NOT IN (SELECT package_id FROM apps);
  ```
- Consolidated Step 8 into Step 2 (8 steps → 7 steps)
- Step 2 now handles both initial packages and cross-referenced installed packages
- Summary positioned correctly to include counts from both addition loops

UI IMPROVEMENTS: Verbose Logging & Clean Output
---------------------------------------------------------
- Implemented callback infrastructure for WinProgramUpdaterGUI:
  * SetLogCallback() with userData pointer
  * SetStatsCallback() for progress updates
  * SetCancelFlag() for interruption support
- All 7 steps now have verbose logging with BEGIN/END markers
- Step 2 output cleaned: Removed extra blank lines before summary
- Fixed "installed" word appearing in 4 message locations (redundant with context)
- Log() function converts \n to \r\n for Windows Edit controls
- Added 300ms delay between GetPackageInfo() calls to reduce winget stress

DATABASE ARCHITECTURE: Path Safety
---------------------------------------------------------
- searchDbPath_ member variable calculated in constructor from main dbPath_
- ATTACH DATABASE now uses escaped searchDbPath_ instead of hardcoded 'WinProgramsSearch.db'
- All database operations use absolute paths from member variables
- Working directory independence ensures reliability across execution contexts

LESSONS LEARNED:
---------------------------------------------------------
- NEVER use relative paths with DeleteFileW() - always use absolute paths
- Winget output format differs between interactive and batch modes
- Parser must handle both spinner lines AND missing "Found" lines
- Database backups are ESSENTIAL - saved entire project from data loss
- SQL queries vastly outperform repeated command execution (4+ hours → instant)
- User intuition matters: "if delay was issue, first would succeed" led to parsing discovery

RESULTS:
- Database: Safe from accidental deletion (10,780 apps preserved)
- Parsing: All 35 missing packages successfully added
- Performance: Step 2.5 eliminated, 4+ hours saved
- Update process: 8 steps consolidated to 7 steps
- Output: Clean, verbose logging without formatting issues

=====================================
Date: 2026-01-26 (Update 4 - Complete Installed Apps Integration)
Component: WinProgramManager / WinProgramUpdater

FEATURE: All Installed Apps Now in Database
---------------------------------------------------------
- Fixed missing installed packages issue: All 47 installed apps now appear in database and UI
- Implemented Step 2.5: Automatic addition of missing installed packages
- Safe deletion logic protects installed apps from being removed
- Hybrid PowerShell architecture resolves C++ pipe buffering issues

STEP 2.5 - MISSING PACKAGE HANDLER:
- New updater step runs after installed apps sync
- Queries database for packages in installed_apps but not in main apps table
- Calls PowerShell script (add_missing_installed_packages.ps1) to fetch metadata
- Uses winget show for each missing package to get complete information
- Inserts package details into apps table with tags
- Handles all packages that weren't captured by winget search

HYBRID POWERSHELL ARCHITECTURE:
Problem Solved: C++ CreateProcess with pipes would hang indefinitely on winget show output
- winget sends progress indicators (spinner chars) that fill pipe buffer
- ReadFile() blocks waiting for more data, CreateProcess deadlocks
- Multiple attempted fixes: PeekNamedPipe, temp files, all failed

Solution: External PowerShell scripts called from C++
- add_missing_installed_packages.ps1: Adds missing packages with full metadata
- check_deleted_packages.ps1: Safely removes obsolete packages
- Scripts packaged with sqlite3.exe for database operations
- C++ orchestrates via CreateProcessA without pipe redirection
- Reliable winget interaction without buffering issues

SAFE PACKAGE DELETION (Step 3):
Logic: Delete ONLY if package is NOT in winget catalog AND NOT installed
- Runs comprehensive "winget search ." to get entire catalog (~10,811 packages)
- Compares database against full catalog, not just search results
- Protects installed apps even if delisted from winget
- Safely removes truly obsolete packages (not available + not installed)
- Result: Database reduced from 10,811 to 10,693 (118 obsolete removed)

ZERO MAGIC NUMBERS:
- All operations driven by database queries and winget API
- No hardcoded package lists or manual interventions
- Systematic approach ensures consistency and maintainability

SCRIPTS:
- WinProgramManager/scripts/add_missing_installed_packages.ps1
  * Query missing packages via SQL
  * Run winget show for each package
  * Parse output for name, version, publisher, tags
  * Insert into apps and app_tags tables
  * Verbose logging with counts and status

- WinProgramManager/scripts/check_deleted_packages.ps1
  * Run winget search . for complete catalog
  * Parse all available package IDs
  * Query non-installed packages from database
  * Delete packages not in catalog AND not installed
  * Comprehensive safety check with 10-minute timeout

PACKAGING:
- makeit.bat updated to package scripts/ folder
- sqlite3.exe copied to WinProgramManager/sqlite3/ for script use
- Scripts work independently of C++ execution context

RESULTS:
- Database: 10,693 apps, 47 installed_apps
- All 47 installed apps present in main apps table
- "Installed" filter shows complete list
- No missing packages, no false deletions

=====================================
Date: 2026-01-26 (Update 3 - Installed Apps Sync Fixed)
Component: WinProgramManager / WinProgramUpdater

BUGFIX: Winget List Parsing Now Working
---------------------------------------------------------
- Fixed SyncInstalledApps() function in WinProgramUpdater.cpp
- Winget list output successfully parsed: 47-52 installed apps detected
- Changed parsing strategy from left-to-right column positions to right-to-left tokenization

PARSING STRATEGY (Right-to-Left):
- Split line into tokens by whitespace
- Rightmost token: Source (e.g., "winget") - must have NO digits
- Second from right: Version number
- Third from right: Package ID
- Remaining tokens: Application name
- Handles lines with and without Source column

VALIDATION LOGIC:
- Reject lines where rightmost token contains any digit (malformed entries)
- Require package ID to contain at least one dot or backslash
- Skip header, separator, and empty lines
- Filter out version-only IDs

REGIONAL COMPATIBILITY:
- Handles Greek regional settings with 60+ second winget response times
- Added --disable-interactivity flag to winget commands
- INFINITE wait in WaitForSingleObject handles regional latency
- No timeout issues despite slow winget responses

DATABASE RESULTS:
- Successfully populates installed_apps table on update
- 47 valid entries from 52 parsed packages (validation filters some)
- Installed filter now shows user's actual installed applications
- Real-time tracking of installation status

STEP 8 OUTPUT:
Before: "Found 0 installed packages"
After: "Found 52 installed packages" → 47 valid entries in database

=====================================
Date: 2026-01-25 (Update 2 - Installed Apps Filter)
Component: WinProgramManager

FEATURE: Installed Apps Filter with Database Integration
---------------------------------------------------------
- Implemented "Installed" button to filter apps by installation status
- Integrated with installed_apps database table for persistent tracking
- Visual state indication: Green with checkmark when active, blue when inactive
- Animated loading dialog when deactivating filter (same as End Search)
- Button color matches Search button design (RGB 10,57,129)

INSTALLED APPS TRACKING:
- installed_apps table with package_id, installed_date, source columns
- sync_installed_apps.ps1 script for database synchronization
- Tracks winget-installed packages on user's system
- Shows count of installed apps in categories and main list

FILTER BEHAVIOR:
- Toggle button: Click once to activate, click again to deactivate
- When active: Shows only installed apps (44 apps in current system)
- When active: Categories filtered to show only those with installed apps (190 categories)
- When deactivated: Shows loading spinner while repopulating full list
- Preserves all search and filter capabilities

USER INTERFACE:
- Button states:
  * Inactive: Blue (RGB 10,57,129), text "Installed"
  * Active: Green (RGB 40,140,40), text "✓ Installed" with checkmark
  * Hover effects for both states
- Positioned next to Search button for consistent navigation
- Smooth spinner animation when returning to all apps

MODULAR ARCHITECTURE:
- installed_apps.h: Public API with 7 functions
- installed_apps.cpp: Encapsulated implementation with static module state
- Clean separation from main.cpp
- O(1) lookup performance using std::set<std::wstring>

DATABASE CLEANUP:
- Removed 169 invalid version-number-only entries (e.g., "0.0.3", "1.0.0")
- Enhanced build_winget_db.ps1 with validation:
  * Rejects package IDs containing only digits, dots, and plus signs
  * Requires at least one letter in package ID
  * Prevents future parse errors
- Final database: 10,981 valid apps (down from 11,150)

TECHNICAL DETAILS:
- Database relationship: apps.package_id → installed_apps.package_id
- LoadInstalledPackageIds() populates in-memory cache from database
- IsPackageInstalled() performs O(1) set lookup
- IsInstalledFilterActive() / SetInstalledFilterActive() manage filter state
- LoadTags() and LoadApps() respect installed filter when active
- Spinner dialog matches End Search behavior for consistency

FILES MODIFIED:
- WinProgramManager/installed_apps.h (NEW)
- WinProgramManager/installed_apps.cpp (NEW)
- WinProgramManager/main.cpp
  * Refactored to use installed_apps API
  * Added spinner when deactivating filter
  * Updated button colors to match Search
- WinProgramManager/CMakeLists.txt
  * Added installed_apps.cpp to build
- WinProgramManager/build_winget_db.ps1
  * Added version-number validation

SCRIPTS AVAILABLE:
- sync_installed_apps.ps1: Sync system packages to database
  Usage: .\sync_installed_apps.ps1
  Result: Updates installed_apps table with current winget list

USER EXPERIENCE IMPROVEMENTS:
- One-click access to installed apps
- Visual feedback with state-aware button colors
- Loading spinner prevents UI freeze perception
- Consistent navigation between Search, Installed, and full list

KNOWN ISSUES RESOLVED:
- Fixed database location (WinProgramManager\WinProgramManager\WinProgramManager.db)
- Fixed brown package icons (bitmap size mismatch 19x19 vs 21x19)
- Removed invalid version-only database entries

=====================================
Date: 2026-01-25 (Update 1 - Search and Icons)
Component: WinProgramManager

FEATURE: Advanced Search Functionality with End Search Dialog
-------------------------------------------------------------
- Implemented comprehensive search system with multi-field filtering
- Visual feedback with animated loading dialog during search operations
- End Search functionality to restore full application list
- Animated spinner dialog during table repopulation
- Brown package icon as default for applications without custom icons

SEARCH CAPABILITIES:
- Multi-field search: Name, Publisher, Package ID
- Case-sensitive and case-insensitive options
- Exact match and substring search modes
- Regular expression support for advanced queries
- Category filtering alongside text search
- Refine results mode to search within current results
- Dynamic result count display

LOADING DIALOG FEATURES:
- Animated blue spinner matching startup dialog design
- "Repopulating table..." message with i18n support
- 60ms animation interval for smooth rotation
- Dialog processes messages during work to keep spinner alive
- ProcessDialogMessages() helper called periodically during LoadTags() and LoadApps()
- Non-blocking UI - spinner animates continuously throughout operation

DEFAULT ICON SYSTEM:
- Brown 3D package icon (RGB 139,90,43) as default at ImageList index 0
- 3D box design with shading: front, top, and side faces
- Tape line detail for realistic appearance
- All apps initialized with iconIndex=0 instead of -1
- Fallback logic ensures brown package displays for apps without custom icons

TECHNICAL DETAILS:
- Search state maintained with atomic flags and result vectors
- In-memory search using g_allApps cache for performance
- Message processing every 10 categories and 50 apps during loading
- Timer-based spinner with Unicode rotation characters (◐ ◓ ◑ ◒)
- IDD_LOADING_DIALOG resource (250×65 pixels, centered)
- g_iconLoadingRunning flag removed - work done on main thread with message pumping

INTERNATIONALIZATION:
- Added "repopulating_table" field to Locale structure
- Updated locale files:
  * en_GB.txt: "Repopulating table..."
  * nb_NO.txt: "Fyller tabellen på nytt..."
  * sv_SE.txt: "Återfyller tabellen..."
- Dialog title uses existing "wait_moment" string

USER EXPERIENCE IMPROVEMENTS:
- End Search button appears during active search
- One-click restoration of full application list
- Visual feedback during potentially slow operations
- Professional appearance with Windows-style info icon
- Smooth spinner animation throughout loading process
- No UI freezing - dialog remains responsive

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Added ProcessDialogMessages() helper function
  * Modified EndSearch() to show loading dialog
  * Enhanced LoadTags() with message processing every 10 items
  * Enhanced LoadApps() with message processing every 50 items
  * Changed app.iconIndex initialization from -1 to 0
  * Added brown package icon creation in CreateControls()
  * Modified fallback icon logic to use index 0
- WinProgramManager/winprogrammanager.rc
  * Added IDD_LOADING_DIALOG resource definition
- WinProgramManager/locale/en_GB.txt
- WinProgramManager/locale/nb_NO.txt
- WinProgramManager/locale/sv_SE.txt

KNOWN ISSUES RESOLVED:
- Fixed spinner not animating (message loop blocked by UI operations)
- Fixed spinner freezing completely during work
- Fixed infinite spinning (worker thread calling UI functions)
- Fixed brown package icons not showing for apps without custom icons
- Fixed spinner only moving during window redraws

=====================================
Date: 2026-01-24
Component: WinProgramManager

FEATURE: Enhanced Category Navigation with Visual Folder Icons
---------------------------------------------------------------
- Implemented yellow folder icons for category list navigation
- Dynamic folder state: closed folders open when selected
- Custom 25×19 pixel folder icons (gr_folder.icon_closed.ico, gr_folder.icon_open.ico)
- Consistent 3px spacing between icons and text in both panes
- Blue selection highlighting on startup and during navigation

TECHNICAL DETAILS:
- Replaced TreeView with ListView for consistent icon control
- Custom folder icons loaded from .ico files (fallback to shell32.dll)
- Icon swapping on selection via LVN_ITEMCHANGED notification
- Category names stored with display spacing (3 leading spaces)
- Display names trimmed for database queries to maintain compatibility
- SetFocus(g_hTagTree) on startup for blue selection highlighting

VISUAL IMPROVEMENTS:
- Category list: 25×19 folder icons with 7px icon-text spacing
- App list: 21×19 app icons with 3px icon-text spacing  
- 4px left margin added to both panes for less cramped appearance
- Wider folder icons accommodate open folder flap design
- Consistent visual spacing between icon and text across both panes

USER EXPERIENCE IMPROVEMENTS:
- Clear visual indication of active category (open folder)
- Blue selection highlighting matches Windows Explorer behavior
- Professional appearance with custom-designed folder icons
- Improved readability with optimized icon-text spacing

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Replaced TreeView with ListView (WC_LISTVIEW)
  * Implemented folder icon swapping on selection
  * Added custom draw for margins and spacing (NM_CUSTOMDRAW)
  * Added display name trimming for database queries
  * Added SetFocus call for blue selection on startup
- WinProgramManager/gr_folder.icon_closed.ico (NEW)
- WinProgramManager/gr_folder.icon_open.ico (NEW)
- WinProgramManager/makeit.bat
  * Added .ico file copying to package directory

ICON SPECIFICATIONS:
- Closed folder icon: 25×19 pixels, yellow theme
- Open folder icon: 25×19 pixels with visible flap, yellow theme
- ImageList size: 25×19 to accommodate largest icon
- App icons: 21×19 pixels (slightly wider than tall)

KNOWN ISSUES RESOLVED:
- Fixed category selection showing grey instead of blue on startup
- Fixed empty category lists due to display spaces in database queries
- Fixed inconsistent spacing between icons and text across panes
- Fixed folder icons not changing state on selection

=====================================
Date: 2026-01-23
Component: WinProgramManager

FEATURE: Professional Startup Loading Dialog
--------------------------------------------
- Implemented threaded loading dialog with continuous animated spinner
- Loading dialog runs in independent thread with own message loop
- Spinner animation never freezes during database loading operations
- White background design matching Windows design language
- Blue spinner (RGB 0, 120, 215) for visual consistency
- Internationalization support for loading text

TECHNICAL DETAILS:
- Loading dialog created in separate thread using LoadingDialogThread()
- Independent message loop prevents UI freezing during main window operations
- Timer-based spinner animation (60ms intervals) with Unicode characters (◐ ◓ ◑ ◒)
- WM_CTLCOLORSTATIC handler for white backgrounds and blue text coloring
- Background thread handles database opening and data loading
- Main window brought to foreground after loading completes (SetForegroundWindow)

INTERNATIONALIZATION:
- Added "processing_database" field to Locale structure
- Updated locale files:
  * en_GB.txt: "Processing database..."
  * nb_NO.txt: "Behandler database..."
  * sv_SE.txt: "Bearbetar databas..."
- Loading text dynamically loaded from locale files

USER EXPERIENCE IMPROVEMENTS:
- Continuous spinner animation from start to finish
- No UI freezing during expensive operations (control creation, database loading)
- Professional appearance with clean white backgrounds
- Immediate visual feedback that application is loading
- Main window automatically activated and brought to front when ready

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Added LoadingDialogThread() function
  * Added LoadingDialogProc() with WM_CTLCOLORSTATIC handler
  * Modified WM_CREATE to be non-blocking
  * Added background thread for database loading
  * Added foreground window activation
- WinProgramManager/locale/en_GB.txt
- WinProgramManager/locale/nb_NO.txt
- WinProgramManager/locale/sv_SE.txt

KNOWN ISSUES RESOLVED:
- Fixed spinner freezing during control creation
- Fixed gray backgrounds on static controls
- Fixed black spinner (now blue as intended)
- Fixed dialog closing too early
- Fixed main window not coming to foreground

=====================================
