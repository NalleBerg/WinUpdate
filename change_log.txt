=== WinProgramSuite Change Log ===
Notes for future versioned changelog

=====================================
Date: 2026-01-25 (Update 2 - Installed Apps Filter)
Component: WinProgramManager

FEATURE: Installed Apps Filter with Database Integration
---------------------------------------------------------
- Implemented "Installed" button to filter apps by installation status
- Integrated with installed_apps database table for persistent tracking
- Visual state indication: Green with checkmark when active, blue when inactive
- Animated loading dialog when deactivating filter (same as End Search)
- Button color matches Search button design (RGB 10,57,129)

INSTALLED APPS TRACKING:
- installed_apps table with package_id, installed_date, source columns
- sync_installed_apps.ps1 script for database synchronization
- Tracks winget-installed packages on user's system
- Shows count of installed apps in categories and main list

FILTER BEHAVIOR:
- Toggle button: Click once to activate, click again to deactivate
- When active: Shows only installed apps (44 apps in current system)
- When active: Categories filtered to show only those with installed apps (190 categories)
- When deactivated: Shows loading spinner while repopulating full list
- Preserves all search and filter capabilities

USER INTERFACE:
- Button states:
  * Inactive: Blue (RGB 10,57,129), text "Installed"
  * Active: Green (RGB 40,140,40), text "✓ Installed" with checkmark
  * Hover effects for both states
- Positioned next to Search button for consistent navigation
- Smooth spinner animation when returning to all apps

MODULAR ARCHITECTURE:
- installed_apps.h: Public API with 7 functions
- installed_apps.cpp: Encapsulated implementation with static module state
- Clean separation from main.cpp
- O(1) lookup performance using std::set<std::wstring>

DATABASE CLEANUP:
- Removed 169 invalid version-number-only entries (e.g., "0.0.3", "1.0.0")
- Enhanced build_winget_db.ps1 with validation:
  * Rejects package IDs containing only digits, dots, and plus signs
  * Requires at least one letter in package ID
  * Prevents future parse errors
- Final database: 10,981 valid apps (down from 11,150)

TECHNICAL DETAILS:
- Database relationship: apps.package_id → installed_apps.package_id
- LoadInstalledPackageIds() populates in-memory cache from database
- IsPackageInstalled() performs O(1) set lookup
- IsInstalledFilterActive() / SetInstalledFilterActive() manage filter state
- LoadTags() and LoadApps() respect installed filter when active
- Spinner dialog matches End Search behavior for consistency

FILES MODIFIED:
- WinProgramManager/installed_apps.h (NEW)
- WinProgramManager/installed_apps.cpp (NEW)
- WinProgramManager/main.cpp
  * Refactored to use installed_apps API
  * Added spinner when deactivating filter
  * Updated button colors to match Search
- WinProgramManager/CMakeLists.txt
  * Added installed_apps.cpp to build
- WinProgramManager/build_winget_db.ps1
  * Added version-number validation

SCRIPTS AVAILABLE:
- sync_installed_apps.ps1: Sync system packages to database
  Usage: .\sync_installed_apps.ps1
  Result: Updates installed_apps table with current winget list

USER EXPERIENCE IMPROVEMENTS:
- One-click access to installed apps
- Visual feedback with state-aware button colors
- Loading spinner prevents UI freeze perception
- Consistent navigation between Search, Installed, and full list

KNOWN ISSUES RESOLVED:
- Fixed database location (WinProgramManager\WinProgramManager\WinProgramManager.db)
- Fixed brown package icons (bitmap size mismatch 19x19 vs 21x19)
- Removed invalid version-only database entries

=====================================
Date: 2026-01-25 (Update 1 - Search and Icons)
Component: WinProgramManager

FEATURE: Advanced Search Functionality with End Search Dialog
-------------------------------------------------------------
- Implemented comprehensive search system with multi-field filtering
- Visual feedback with animated loading dialog during search operations
- End Search functionality to restore full application list
- Animated spinner dialog during table repopulation
- Brown package icon as default for applications without custom icons

SEARCH CAPABILITIES:
- Multi-field search: Name, Publisher, Package ID
- Case-sensitive and case-insensitive options
- Exact match and substring search modes
- Regular expression support for advanced queries
- Category filtering alongside text search
- Refine results mode to search within current results
- Dynamic result count display

LOADING DIALOG FEATURES:
- Animated blue spinner matching startup dialog design
- "Repopulating table..." message with i18n support
- 60ms animation interval for smooth rotation
- Dialog processes messages during work to keep spinner alive
- ProcessDialogMessages() helper called periodically during LoadTags() and LoadApps()
- Non-blocking UI - spinner animates continuously throughout operation

DEFAULT ICON SYSTEM:
- Brown 3D package icon (RGB 139,90,43) as default at ImageList index 0
- 3D box design with shading: front, top, and side faces
- Tape line detail for realistic appearance
- All apps initialized with iconIndex=0 instead of -1
- Fallback logic ensures brown package displays for apps without custom icons

TECHNICAL DETAILS:
- Search state maintained with atomic flags and result vectors
- In-memory search using g_allApps cache for performance
- Message processing every 10 categories and 50 apps during loading
- Timer-based spinner with Unicode rotation characters (◐ ◓ ◑ ◒)
- IDD_LOADING_DIALOG resource (250×65 pixels, centered)
- g_iconLoadingRunning flag removed - work done on main thread with message pumping

INTERNATIONALIZATION:
- Added "repopulating_table" field to Locale structure
- Updated locale files:
  * en_GB.txt: "Repopulating table..."
  * nb_NO.txt: "Fyller tabellen på nytt..."
  * sv_SE.txt: "Återfyller tabellen..."
- Dialog title uses existing "wait_moment" string

USER EXPERIENCE IMPROVEMENTS:
- End Search button appears during active search
- One-click restoration of full application list
- Visual feedback during potentially slow operations
- Professional appearance with Windows-style info icon
- Smooth spinner animation throughout loading process
- No UI freezing - dialog remains responsive

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Added ProcessDialogMessages() helper function
  * Modified EndSearch() to show loading dialog
  * Enhanced LoadTags() with message processing every 10 items
  * Enhanced LoadApps() with message processing every 50 items
  * Changed app.iconIndex initialization from -1 to 0
  * Added brown package icon creation in CreateControls()
  * Modified fallback icon logic to use index 0
- WinProgramManager/winprogrammanager.rc
  * Added IDD_LOADING_DIALOG resource definition
- WinProgramManager/locale/en_GB.txt
- WinProgramManager/locale/nb_NO.txt
- WinProgramManager/locale/sv_SE.txt

KNOWN ISSUES RESOLVED:
- Fixed spinner not animating (message loop blocked by UI operations)
- Fixed spinner freezing completely during work
- Fixed infinite spinning (worker thread calling UI functions)
- Fixed brown package icons not showing for apps without custom icons
- Fixed spinner only moving during window redraws

=====================================
Date: 2026-01-24
Component: WinProgramManager

FEATURE: Enhanced Category Navigation with Visual Folder Icons
---------------------------------------------------------------
- Implemented yellow folder icons for category list navigation
- Dynamic folder state: closed folders open when selected
- Custom 25×19 pixel folder icons (gr_folder.icon_closed.ico, gr_folder.icon_open.ico)
- Consistent 3px spacing between icons and text in both panes
- Blue selection highlighting on startup and during navigation

TECHNICAL DETAILS:
- Replaced TreeView with ListView for consistent icon control
- Custom folder icons loaded from .ico files (fallback to shell32.dll)
- Icon swapping on selection via LVN_ITEMCHANGED notification
- Category names stored with display spacing (3 leading spaces)
- Display names trimmed for database queries to maintain compatibility
- SetFocus(g_hTagTree) on startup for blue selection highlighting

VISUAL IMPROVEMENTS:
- Category list: 25×19 folder icons with 7px icon-text spacing
- App list: 21×19 app icons with 3px icon-text spacing  
- 4px left margin added to both panes for less cramped appearance
- Wider folder icons accommodate open folder flap design
- Consistent visual spacing between icon and text across both panes

USER EXPERIENCE IMPROVEMENTS:
- Clear visual indication of active category (open folder)
- Blue selection highlighting matches Windows Explorer behavior
- Professional appearance with custom-designed folder icons
- Improved readability with optimized icon-text spacing

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Replaced TreeView with ListView (WC_LISTVIEW)
  * Implemented folder icon swapping on selection
  * Added custom draw for margins and spacing (NM_CUSTOMDRAW)
  * Added display name trimming for database queries
  * Added SetFocus call for blue selection on startup
- WinProgramManager/gr_folder.icon_closed.ico (NEW)
- WinProgramManager/gr_folder.icon_open.ico (NEW)
- WinProgramManager/makeit.bat
  * Added .ico file copying to package directory

ICON SPECIFICATIONS:
- Closed folder icon: 25×19 pixels, yellow theme
- Open folder icon: 25×19 pixels with visible flap, yellow theme
- ImageList size: 25×19 to accommodate largest icon
- App icons: 21×19 pixels (slightly wider than tall)

KNOWN ISSUES RESOLVED:
- Fixed category selection showing grey instead of blue on startup
- Fixed empty category lists due to display spaces in database queries
- Fixed inconsistent spacing between icons and text across panes
- Fixed folder icons not changing state on selection

=====================================
Date: 2026-01-23
Component: WinProgramManager

FEATURE: Professional Startup Loading Dialog
--------------------------------------------
- Implemented threaded loading dialog with continuous animated spinner
- Loading dialog runs in independent thread with own message loop
- Spinner animation never freezes during database loading operations
- White background design matching Windows design language
- Blue spinner (RGB 0, 120, 215) for visual consistency
- Internationalization support for loading text

TECHNICAL DETAILS:
- Loading dialog created in separate thread using LoadingDialogThread()
- Independent message loop prevents UI freezing during main window operations
- Timer-based spinner animation (60ms intervals) with Unicode characters (◐ ◓ ◑ ◒)
- WM_CTLCOLORSTATIC handler for white backgrounds and blue text coloring
- Background thread handles database opening and data loading
- Main window brought to foreground after loading completes (SetForegroundWindow)

INTERNATIONALIZATION:
- Added "processing_database" field to Locale structure
- Updated locale files:
  * en_GB.txt: "Processing database..."
  * nb_NO.txt: "Behandler database..."
  * sv_SE.txt: "Bearbetar databas..."
- Loading text dynamically loaded from locale files

USER EXPERIENCE IMPROVEMENTS:
- Continuous spinner animation from start to finish
- No UI freezing during expensive operations (control creation, database loading)
- Professional appearance with clean white backgrounds
- Immediate visual feedback that application is loading
- Main window automatically activated and brought to front when ready

FILES MODIFIED:
- WinProgramManager/main.cpp
  * Added LoadingDialogThread() function
  * Added LoadingDialogProc() with WM_CTLCOLORSTATIC handler
  * Modified WM_CREATE to be non-blocking
  * Added background thread for database loading
  * Added foreground window activation
- WinProgramManager/locale/en_GB.txt
- WinProgramManager/locale/nb_NO.txt
- WinProgramManager/locale/sv_SE.txt

KNOWN ISSUES RESOLVED:
- Fixed spinner freezing during control creation
- Fixed gray backgrounds on static controls
- Fixed black spinner (now blue as intended)
- Fixed dialog closing too early
- Fixed main window not coming to foreground

=====================================
